# ADR-003: Content Architecture and Metadata

**Status**: Accepted
**Date**: 2025-12-02
**Deciders**: Architecture Team, Content Lead
**Technical Story**: [specs/1-docusaurus/spec.md](../../specs/1-docusaurus/spec.md)

## Context

The Physical AI book requires a content architecture that supports:

- **Constitutional Requirement**: Content must follow Docusaurus conventions (docs/ structure per Principle II), support progressive complexity (fundamentals → advanced per Principle I)
- **Metadata Requirements**: Frontmatter with learning objectives, difficulty level, chapter information (FR-019)
- **Navigation**: Hierarchical chapter organization with automatic sidebar generation (FR-002)
- **Search**: Content must be indexable for full-text search (FR-003)
- **Scalability**: Support 500+ pages (50 chapters × 10 sections average) without degradation (SC-010)
- **Authoring Workflow**: Authors use Git/Markdown; content must be portable and version-controlled

We need to define the file structure, frontmatter schema, and content organization patterns that balance structure (for machine processing) with flexibility (for author creativity).

## Decision

We will use **Markdown with Frontmatter + Docusaurus Directory Conventions** for content architecture:

### Directory Structure:

```
docs/
├── intro.md                    # Book introduction (homepage content)
├── chapter-01-foundations/     # Chapter 1: Foundational concepts
│   ├── index.md                # Chapter overview page
│   ├── 01-introduction.md      # Section 1
│   ├── 02-history.md           # Section 2
│   └── 03-key-concepts.md      # Section 3
├── chapter-02-mechanics/       # Chapter 2: Intermediate mechanics
│   ├── index.md
│   ├── 01-sensors.md
│   ├── 02-actuators.md
│   └── 03-control-systems.md
├── chapter-03-advanced/        # Chapter 3: Advanced topics
│   └── ...
└── glossary.md                 # Terms and definitions
```

**Naming Convention**:
- Chapters: `chapter-##-slug/` (e.g., `chapter-01-foundations/`)
- Sections: `##-slug.md` (e.g., `01-introduction.md`)
- Index pages: `index.md` (chapter overview, auto-linked in sidebar)

**Progressive Complexity**:
- Chapters ordered numerically by difficulty (01=beginner, 10=advanced)
- Frontmatter `difficulty` field (beginner, intermediate, advanced, expert)
- Sidebar auto-generated from directory structure (preserves order)

### Frontmatter Schema:

```yaml
---
# Required Fields
title: "Introduction to Physical AI"
description: "Learn the foundational concepts of embodied artificial intelligence"
difficulty: "beginner"           # beginner | intermediate | advanced | expert
chapter: "Foundations"           # Chapter name (for breadcrumbs)
chapter_number: 1                # Numeric chapter (for sorting)

# Optional Fields
learning_objectives:             # What readers will learn (FR-019)
  - "Understand the definition of Physical AI"
  - "Identify key differences from traditional AI"
  - "Recognize real-world applications"

prerequisites:                   # Required knowledge (progressive complexity)
  - "Basic programming concepts"
  - "Familiarity with Python"

estimated_time: "15 minutes"     # Reading time estimate

keywords:                        # SEO and search (FR-011)
  - "physical AI"
  - "embodied intelligence"
  - "robotics"

last_updated: "2025-12-02"       # Content freshness tracking
---
```

**Required vs Optional**:
- **Required**: `title`, `description`, `difficulty`, `chapter`, `chapter_number`
- **Optional**: `learning_objectives`, `prerequisites`, `estimated_time`, `keywords`, `last_updated`
- **Auto-generated**: `sidebar_position` (from filename number), `slug` (from filename)

### Sidebar Configuration (sidebars.js):

```javascript
module.exports = {
  bookSidebar: [
    {
      type: 'doc',
      id: 'intro',
      label: 'Introduction'
    },
    {
      type: 'category',
      label: 'Chapter 1: Foundations',
      items: [
        {
          type: 'autogenerated',
          dirName: 'chapter-01-foundations'  // Auto-generates from directory
        }
      ]
    },
    {
      type: 'category',
      label: 'Chapter 2: Mechanics',
      items: [
        {
          type: 'autogenerated',
          dirName: 'chapter-02-mechanics'
        }
      ]
    },
    // Additional chapters...
    {
      type: 'doc',
      id: 'glossary',
      label: 'Glossary'
    }
  ]
};
```

**Auto-generation Benefits**:
- Sidebar auto-updates when files added/removed (FR-012)
- Preserves numeric ordering (01, 02, 03)
- Reduces manual configuration (less error-prone)

### Content Organization Patterns:

1. **Chapter Index Pattern**: Each chapter has `index.md` overview
   - Summarizes chapter scope
   - Lists learning objectives for entire chapter
   - Links to individual sections

2. **Section Pattern**: Individual concept per file
   - Focused on single topic (reduces cognitive load)
   - 5-15 minute read time (average 1500-3000 words)
   - Previous/next navigation auto-generated

3. **Progressive Disclosure**: Complex topics split across sections
   - Beginner sections first, advanced sections last
   - Use `prerequisites` frontmatter to indicate dependencies

## Consequences

### Positive:

- **Structured Metadata**: Frontmatter enables filtering by difficulty, search by keywords, displaying learning objectives (FR-019)
- **Automatic Navigation**: Directory structure + auto-generation = sidebar updates automatically (FR-012)
- **Search Optimization**: Keywords in frontmatter + full-text Markdown content = comprehensive search (FR-003, FR-011)
- **Progressive Complexity**: Numeric ordering + difficulty field enforce constitutional requirement (Principle I)
- **Author-Friendly**: Markdown is familiar; frontmatter is optional (except required fields); Git workflow unchanged
- **Portable Content**: Markdown files portable to other platforms; only sidebars.js is Docusaurus-specific
- **Scalability**: Directory-based organization supports 500+ pages without performance issues (SC-010)
- **Maintenance**: File-per-section = easier collaboration (less merge conflicts vs monolithic chapters)

### Negative:

- **Frontmatter Overhead**: Authors must fill 5 required fields per page (learning curve for new contributors)
  - **Mitigation**: Provide template files with pre-filled frontmatter; document schema in CONTRIBUTING.md
- **Schema Evolution**: Changing frontmatter schema requires migration across all files (potential breaking change)
  - **Mitigation**: Version frontmatter schema; write migration scripts; maintain backward compatibility
- **Directory Refactoring**: Renaming chapters breaks links and sidebar (requires coordinated update)
  - **Mitigation**: Link validation in CI (FR-018) catches broken links; batch refactoring with PRs
- **Duplicate Metadata**: Chapter name appears in directory, frontmatter, and sidebars.js (DRY violation)
  - **Mitigation**: Acceptable trade-off for explicit configuration; reduces magic/implicit behavior
- **Limited Validation**: No automated frontmatter validation (authors can omit required fields)
  - **Mitigation**: Add frontmatter linter in Phase 3 CI (check required fields exist, valid values)

### Risks:

| Risk | Likelihood | Impact | Mitigation |
|------|------------|--------|------------|
| Frontmatter schema changes break existing content | Medium | High | Version schema; write migration scripts; test on staging before production |
| Authors forget required frontmatter fields | High | Low | Template files; frontmatter linter in CI; PR reviews check schema |
| Chapter reorganization breaks many links | Low | Medium | Link validation in CI; batch refactoring; deprecation warnings |
| Directory depth limits (Docusaurus or Git) | Low | Low | Test at 500 pages (Phase 4); flatten structure if needed |

## Alternatives Considered

### Alternative 1: External Metadata (YAML/JSON Config Files)

**Pros**:
- Centralized metadata management (single source of truth)
- Easier schema evolution (one file to update vs many)
- Validation easier (JSON schema validation)

**Cons**:
- Authors must update two files (Markdown + config) for each page
- Harder to keep in sync (config can diverge from actual files)
- Less portable (content + config must travel together)
- Docusaurus convention favors frontmatter (better ecosystem support)

**Rejected because**: Violates Docusaurus conventions; increases maintenance burden

### Alternative 2: Unstructured Markdown (No Frontmatter)

**Pros**:
- Simplest for authors (just write Markdown)
- Maximum portability (no Docusaurus-specific metadata)
- Zero learning curve for contributors

**Cons**:
- ❌ **Violates FR-019** (frontmatter required for learning objectives, difficulty, metadata)
- No metadata for search optimization (FR-011)
- No progressive complexity enforcement (Constitutional Principle I)
- No learning objective display (spec requirement)

**Rejected because**: Fails to meet functional requirements (FR-019) and constitutional mandate (Principle I)

### Alternative 3: Database-Backed Content (Headless CMS)

**Pros**:
- Rich metadata schema with validation
- Easier search and filtering (SQL queries vs text search)
- Versioning and workflow management built-in

**Cons**:
- ❌ **Violates Constitutional Principle** (static site only, no backend/database)
- Requires hosting (not free tier)
- Authors must use CMS UI (no Git/Markdown workflow)
- Content not version-controlled in Git (loses audit trail)

**Rejected because**: Violates constitutional requirement (no backend/database allowed)

### Alternative 4: MDX with Embedded Metadata (JSX Components)

**Pros**:
- Metadata embedded in content (e.g., `<LearningObjectives>...</LearningObjectives>`)
- More flexible rendering (custom React components)
- Type-safe metadata (TypeScript props)

**Cons**:
- Less portable (MDX not as widely supported as Markdown)
- More complex for non-technical authors (JSX syntax)
- Harder to validate (metadata scattered throughout file)
- Frontmatter is Docusaurus best practice (better ecosystem support)

**Rejected because**: Increases complexity for authors without significant benefit

## References

- [specs/1-docusaurus/plan.md](../../specs/1-docusaurus/plan.md) - Content structure in Component 2
- [specs/1-docusaurus/spec.md](../../specs/1-docusaurus/spec.md) - FR-002, FR-019 (frontmatter requirements)
- [.specify/memory/constitution.md](../../.specify/memory/constitution.md) - Principle I (progressive complexity), Principle II (Docusaurus conventions)
- [Docusaurus Docs: Markdown Features](https://docusaurus.io/docs/markdown-features) - Frontmatter specification
- [Docusaurus Docs: Sidebar](https://docusaurus.io/docs/sidebar) - Auto-generation patterns

## Notes

This ADR documents the content architecture that balances structure (machine-processable metadata) with simplicity (author-friendly Markdown). The frontmatter schema is designed to support all spec requirements (FR-019, FR-011, Principle I) while remaining optional for non-critical fields.

The directory-based organization follows Docusaurus best practices and enables auto-generated sidebars (reducing manual configuration). The schema is versioned and migration scripts will be written before any breaking changes.

Future schema additions (e.g., `contributors`, `review_status`) should maintain backward compatibility or follow the migration process defined here.
